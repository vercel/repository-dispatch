name: "Vercel Repository Dispatch - Debug"
description: "Action for Vercel repository dispatch deployment events. Useful for viewing the full payload from the event."

runs:
  using: "composite"
  steps:
    - name: Debug Client Payload
      shell: bash
      run: |
        # Debugging Vercel Repository Dispatch Client Payload

        echo ""
        echo "ğŸ” Debugging Vercel Repository Dispatch Client Payload:"

        # Check if this is a repository_dispatch event
        if [[ "${{ github.event_name }}" != "repository_dispatch" ]]; then
          echo "âŒ This action is designed for repository_dispatch events only."
          echo "ğŸ“‹ Current event type: ${{ github.event_name }}"
          exit 0
        fi

        # Output the full client payload in a collapsible section
        echo "::group::ğŸ“¦ Raw Payload (Click to expand)"
        echo '${{ toJSON(github.event.client_payload) }}'
        echo "::endgroup::"
        echo ""

        # output a header to indicate the individual fields
        echo "ğŸ” Details"

        # Output individual fields with prefixes
        echo "::group::  - 4. ğŸš€ Deployment"
        echo "ğŸ†” Deployment ID: ${{ github.event.client_payload.id || 'None' }}"
        echo "ğŸŒ Deployment URL: ${{ github.event.client_payload.url || 'None' }}"
        echo "ğŸ“ˆ Deployment State: ${{ github.event.client_payload.state.type || 'None' }}"
        echo "ğŸ“‹ Deployment State Details: ${{ github.event.client_payload.state.detail || 'N/A' }}"
        echo "::endgroup::"

        echo "::group::  - 1. ğŸ—ï¸ Project"
        echo "ğŸ†” Project ID: ${{ github.event.client_payload.project.id || 'None' }}"
        echo "ğŸ“ Project Name: ${{ github.event.client_payload.project.name || 'None' }}"
        echo "::endgroup::"

        echo "::group::  - 2. ğŸŒ Environment"
        echo "ğŸŒ± Environment: ${{ github.event.client_payload.environment || 'None' }}"
        echo "::endgroup::"

        echo "::group::  - 3. ğŸ“š Git"
        echo "ğŸŒ¿ Git Ref: ${{ github.event.client_payload.git.ref || 'None' }}"
        echo "ğŸ”— Git SHA: ${{ github.event.client_payload.git.sha || 'None' }}"
        echo "âœ‚ï¸ Short SHA: ${{ github.event.client_payload.git.shortSha || 'None' }}"
        echo "::endgroup::"

        # Check for error information
        if [[ -n "${{ github.event.client_payload.error }}" ]]; then
          echo "::group::  - 5. âŒ Error Information"
          echo "ğŸ’¥ Error: ${{ github.event.client_payload.error }}"
          echo "::endgroup::"
        fi

        echo ""
        echo "ğŸ‰ Debug output complete!"
        echo ""
